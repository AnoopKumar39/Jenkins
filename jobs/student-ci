pipeline {
    agent {
        node {
            label 'MAVEN'
        }
    }
    environment {
        SONAR_URL="sonar.devopsprac.ml"
        SONAR_TOKEN=credentials('StudentappToken')


    }
      stages {
          stage('Cloning Repo') {
              steps {
                  git credentialsId: 'GitUserPass', url: 'https://github.com/AnoopKumar39/studentapp-ui.git'
              }
          }
          stage('Maven Compile') {
              steps {
                  sh label: '', script: 'mvn compile'
              }
          }
          stage('CodeQualityCheck') {
              steps {
                withSonarQubeEnv('SonarQube') {
                  sh label: '', script: '''mvn sonar:sonar \\
                   -Dsonar.projectKey=Student-CI \\
                   -Dsonar.host.url=http://${SONAR_URL}:9000 \\
                   -Dsonar.login=${SONAR_TOKEN}'''
                }
              }
          }
          stage("Quality Gate") {
            steps {
              timeout(time: 5, unit: 'MINUTES') {
                waitForQualityGate abortPipeline: true
              }
            }
          } 
      }
}